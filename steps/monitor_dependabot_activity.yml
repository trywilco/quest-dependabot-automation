id: monitor_dependabot_activity
learningObjectives:
  - Monitor and review Dependabot pull requests.
hints:
  - Check the 'Pull requests' tab in your GitHub repository for new Dependabot
    suggestions.
  - Review the code changes in each pull request to ensure they meet your
    standards.
startFlow:
  do:
    - actionId: bot_message
      params:
        person: lucca
        messages:
          - text: Alright, the setup is done, but the journey doesn't end here.
          - text: Now, it's time to watch for Dependabot-generated pull requests. Keep an
              eye on the [Actions Tab](${user.repository}/actions/workflows/dependabot/dependabot-updates) and check its progress.
          - text: While the Dependabot action is running (might take a few minutes to complete) it will create a bunch of pull requests as it goes.
          - text: Keep an eye on [your Pull Requests tab](${user.repository}/pulls) as dependabot creates them.
          - text: Choose one of the Dependabot pull requests from the list and copy the branch name.
          - text: ":instruction[Give me the PR **branch name** so i'll merge it]."

trigger:
  type: user_message
  flowNode:
    do:
      - actionId: github_repo_api
        name: get_branch_name
        params:
          method: get
          path: /branches/${userMessageText}
    if:
      conditions:
        - conditionId: text_contains_strings
          params:
            text: "${userMessageText}"
            strings:
              - dependabot/
        - conditionId: is_truthy
          params:
            value: ${outputs.get_branch_name.data?.name}
      then:
        do:
          - actionId: bot_message
            params:
              person: lucca
              messages:
                - text: Thanks for the update! I'll merge the PR for you. Give me a moment.
          - actionId: github_merge_pr
            params:
              headBranch: ${userMessageText}
          - actionId: bot_message
            params:
              person: lucca
              messages:
                - text: "You've just completed the Automate with Dependabot questâ€”great job! You configured GitHub Dependabot to automatically scan your project's dependencies for vulnerabilities and set up a Dependabot config file to keep your dependencies updated. You also practiced monitoring Dependabot alerts and reviewing its security update pull requests to keep your project safe."
                - text: "Next, to strengthen your skills and apply them more confidently, here's a personalized learning path:"
                - text: "ðŸ‘‰ GitHub Skills: [Introduction to CodeQL](https://github.com/skills/introduction-to-codeql) â€“ practice running code scanning with CodeQL to identify and fix insecure coding patterns in your codebase."
                - text: "ðŸ‘‰ Microsoft Learn: [Configure Dependabot security updates on your GitHub repo](https://learn.microsoft.com/en-us/training/modules/configure-dependabot-security-updates-on-github-repo/) â€“ deepen your understanding of dependency management by learning how to configure Dependabot alerts, analyze vulnerability details, and manage automated security updates on GitHub."
                - text: "ðŸ‘‰ Microsoft Applied Skills: [GitHub Advanced Security](https://learn.microsoft.com/en-us/credentials/certifications/github-advanced-security/) â€“ earn a credential that validates your GitHub security expertise, from finding vulnerabilities to implementing secure workflows."
          - actionId: finish_step

      else:
        do:
          - actionId: bot_message
            params:
              person: lucca
              messages:
                - text: Are you sure? It doesn't seem like a Dependabot branch. Please try again.
